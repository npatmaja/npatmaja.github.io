<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>

    <script type="text/javascript">
        if (window.location.hostname == 'www.nauvalatmaja.com' || window.location.hostname == 'nauvalatmaja.com') {

          (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
          (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
          })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

          ga('create', 'UA-58073141-1', 'auto');
          ga('send', 'pageview');  
        }
    </script>

    <title>Rendering Mermaid in Docpad | nauval atmaja</title>
    <meta name="author" content="Nauval Atmaja">
    <meta name="description" content="Nauval Atmaja's personal notes on software development and all that">
    <meta name="keywords" content="software, engineering, software engineering, architecture, software architecture, programming, thought, javascript, node.js, ruby on rails, java, HTML, code, hack, tips, trick, *nix, OSX">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="/feed.xml" rel="alternate" title="www.nauvalatmaja.com" type="application/atom+xml">
    <!-- <link rel="icon" sizes="300x300" href="icon/icon.png"> -->
    <!-- <link rel="icon" sizes="196x196" href="icon/icon-196.png"> -->
    <!-- <link rel="icon" sizes="128x128" href="icon/icon-128.png"> -->
    <!-- <link rel="apple-touch-icon" sizes="128x128" href="icon/icon-128.png"> -->
    <!-- <link rel="apple-touch-icon-precomposed" sizes="128x128" href="icon/icon-128.png"> -->
    <link href="/ico/favicon.ico" rel="shortcut icon">

    <!-- Bootstrap -->
    <link href="/styles/site.css?" rel="stylesheet" media="screen">
    <link rel="stylesheet" type="text/css" href="/vendor/rainbow.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="/scripts/vendor/html5shiv.js"></script>
    <script src="/scripts/vendor/respond.min.js"></script>
    <![endif]-->

    <meta name="generator" content="DocPad v6.69.2" />
    
</head>
<body>

<a href="https://plus.google.com/112846605467404730226?rel=author" class="google googleplus-hidden" title="Google+">Google+</a>

<div class="navbar navbar-default navbar-static-top navbar-shadow">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/"><span class="text-primary">nauval atmaja</span></a>
        </div>
        <div class="collapse navbar-collapse navbar-right">
            <ul class="nav navbar-nav">
                <!--<li><a href="/">Blog</a></li>-->
                <!-- <li><a href="/archives/">Archives</a></li> -->
                
                    <li typeof="sioc:Page", about= /pages/archives/>
                      <a href='/pages/archives/', property="dc:title">Blog Archives</a>
                    </li>
                
                <li class="hidden-xs">
                    <a href="/feed.xml" class="rss"><span class="icon icon-feed"></span></a>
                    <a href="https://twitter.com/novalpas" class="twitter"><span class="icon icon-twitter"></span></a>
                    <a href="https://github.com/npatmaja" class="github"><span class="icon icon-github"></span></a>
                    <a href="https://id.linkedin.com/in/nauvalatmaja/" class="linkedin"><span class="icon icon-linkedin"></span></a>
                </li>
            </ul>
            <form class="navbar-form navbar-right hidden-xs" role="search" action="http://google.com/search"
                  method="get">
                <div class="form-group">
                    <input type="search" name="q" class="form-control" placeholder="Search">
                    <input type="hidden" name="q" value="site:www.nauvalatmaja.com">
                </div>
            </form>
        </div>
    </div>
</div>
<div class="clear">
<div class="container">
    <div class="row">
        <div class="col-sm-12 col-md-10">
            
            <article id="post" class="post">
    
        <h1>Rendering Mermaid in Docpad</h1>
    
    <div class="post-date">Jan 13th, 2015</div>
    <div class="post-content">
        <p>I stumbled across <a href="http://knsv.github.io/mermaid/">Mermaid</a> when I saw 
<a href="https://twitter.com/nikmd23/status/553224624130228225">@ronaldwidha retweeted a tweet about it</a>. 
Mermaid is a library for <em>writing</em> diagrams instead of draw 
them similar to <a href="https://github.com/chjj/marked">Marked</a>
to markdown, awesome! So, I thought I could use this in my blog just in case I 
need to draw some flowcharts or sequence diagrams in the future.</p>
<p>DocPad uses Marked to render markdown to html via 
<a href="https://github.com/docpad/docpad-plugin-marked">docpad-plugin-marked</a> 
but natively, it doesn&#39;t support 
Mermaid syntax. Fortunately, Marked provide 
<a href="https://github.com/chjj/marked#overriding-renderer-methods">a way to override its renderer</a>,
however, it is not yet supported in the current release of the docpad-plugin-marked,
and <a href="https://github.com/docpad/docpad-plugin-marked/issues/11">someone created a ticket on this issue</a>. 
So based on the 
explanation there, I forked the plugin and started to hack it down. 
To add the functionality itself was not that hard but to define a proper test
for the plugin was tougher than it looks, at least at first as I didn&#39;t quite 
understand how DocPad&#39;s plugin tester works. Thanks to <a href="http://www.delarre.net/posts/unit-testing-docpad-plugins/">this awesome post</a>, 
I could finally write and pass the test. The working version of my fork
can be found <a href="https://github.com/npatmaja/docpad-plugin-marked">at my GitHub</a>.</p>
<!-- Read more -->

<p>To use the forked plugin, change the dependency definition in <code>package.json</code>:</p>
<pre class="highlight"><code class="hljs undefined">"docpad-plugin-marked": "git+ssh://git@github.com:npatmaja/docpad-plugin-marked.git"
</code></pre>
<p>Next is to redefine the <code>code</code> renderer by putting the definition in the <code>docpad.coffee</code></p>
<pre class="highlight"><code class="hljs coffeescript"><span class="hljs-attribute">plugins</span>:
  <span class="hljs-attribute">marked</span>:
    <span class="hljs-attribute">markedRenderer</span>:
      <span class="hljs-attribute">code</span>: <span class="hljs-function"><span class="hljs-params">(code, lang)</span> -&gt;</span>
<span class="hljs-function">        <span class="hljs-title">escape</span> = <span class="hljs-params">(html, encode)</span> -&gt;</span>
          pattern = <span class="hljs-keyword">if</span> !encode <span class="hljs-keyword">then</span> <span class="hljs-regexp">/&amp;(?!#?\w+;)/g</span>  <span class="hljs-keyword">else</span> <span class="hljs-regexp">/&amp;/g</span>
          <span class="hljs-keyword">return</span> html
            .replace(pattern, <span class="hljs-string">'&amp;amp;'</span>)
            .replace(<span class="hljs-regexp">/&lt;/g</span>, <span class="hljs-string">'&amp;lt;'</span>)
            .replace(<span class="hljs-regexp">/&gt;/g</span>, <span class="hljs-string">'&amp;gt;'</span>)
            .replace(<span class="hljs-regexp">/"/g</span>, <span class="hljs-string">'&amp;quot;'</span>)
            .replace(<span class="hljs-regexp">/'/g</span>, <span class="hljs-string">'&amp;#39;'</span>)

        <span class="hljs-keyword">if</span> code.match(<span class="hljs-regexp">/^sequenceDiagram/</span>)|| code.match(<span class="hljs-regexp">/^graph/</span>)
          <span class="hljs-keyword">return</span> <span class="hljs-string">"&lt;div class=\"mermaid\"&gt;\n<span class="hljs-subst">#{code}</span>\n&lt;/div&gt;\n"</span>
        <span class="hljs-keyword">else</span>
          <span class="hljs-keyword">if</span> <span class="hljs-property">@options</span>.highlight
            out = <span class="hljs-property">@options</span>.highlight code, lang
            <span class="hljs-keyword">if</span> out != <span class="hljs-literal">null</span> &amp;&amp; out != code
              escaped = <span class="hljs-literal">true</span>
              code = out

          <span class="hljs-keyword">if</span> !lang
            <span class="hljs-keyword">return</span> <span class="hljs-string">'&lt;pre&gt;&lt;code&gt;'</span> +
              (<span class="hljs-keyword">if</span> escaped <span class="hljs-keyword">then</span> code <span class="hljs-keyword">else</span> escape(code, <span class="hljs-literal">true</span>)) +
              <span class="hljs-string">'\n&lt;/code&gt;&lt;/pre&gt;'</span>

          <span class="hljs-keyword">return</span> <span class="hljs-string">'&lt;pre&gt;&lt;code class="'</span> +
            <span class="hljs-keyword">this</span>.options.langPrefix +
            escape(lang, <span class="hljs-literal">true</span>) +
            <span class="hljs-string">'"&gt;'</span> +
            (<span class="hljs-keyword">if</span> escaped <span class="hljs-keyword">then</span> code <span class="hljs-keyword">else</span> escape(code, <span class="hljs-literal">true</span>)) +
            <span class="hljs-string">'\n&lt;/code&gt;&lt;/pre&gt;\n'</span>
</code></pre><p>Lastly, I added Mermaid.js to blog&#39;s layout as mentioned on Mermaid&#39;s
documentation. Now all are set to their place, so whenever I put Mermaid 
syntax in a markdown&#39;s code block <code>```</code> the code will 
be transformed to svg image. </p>
<p>Without further ado, below are a couple of examples of Mermaid diagram
definition and their respective rendered diagram. It&#39;s show time!</p>
<h1 id="simple-graph">Simple graph</h1>
<pre class="highlight"><code class="hljs livecodeserver">%% remove comment <span class="hljs-built_in">to</span> render <span class="hljs-operator">the</span> graph
graph TB 
  subgraph <span class="hljs-constant">one</span> 
    a1<span class="hljs-comment">--&gt;a2</span>
  <span class="hljs-function"><span class="hljs-keyword">end</span></span>
  subgraph <span class="hljs-constant">two</span>
    b1<span class="hljs-comment">--&gt;b2</span>
  <span class="hljs-function"><span class="hljs-keyword">end</span></span>
  subgraph <span class="hljs-constant">three</span>
    c1<span class="hljs-comment">--&gt;c2</span>
  <span class="hljs-function"><span class="hljs-keyword">end</span></span>
  c1<span class="hljs-comment">--&gt;a2</span>
</code></pre><div class="mermaid">
graph TB 
  subgraph one 
    a1-->a2
  end
  subgraph two
    b1-->b2
  end
  subgraph three
    c1-->c2
  end
  c1-->a2
</div>
<h1 id="sequence-diagram">Sequence diagram</h1>
<pre class="highlight"><code class="hljs livecodeserver">%% remove comment <span class="hljs-built_in">to</span> render <span class="hljs-operator">the</span> diagram
sequenceDiagram
  Alice -&gt;&gt; Bob: Hello Bob, how are you?
  Bob<span class="hljs-comment">--&gt;&gt;John: How about you John?</span>
  Bob<span class="hljs-comment">--x Alice: I am good thanks!</span>
  Bob-x John: I am good thanks!
  Note <span class="hljs-constant">right</span> <span class="hljs-operator">of</span> John: Bob thinks <span class="hljs-operator">a</span> <span class="hljs-keyword">long</span>&lt;br/&gt;<span class="hljs-keyword">long</span> <span class="hljs-built_in">time</span>, so <span class="hljs-keyword">long</span>&lt;br/&gt;that <span class="hljs-operator">the</span> <span class="hljs-keyword">text</span> does&lt;br/&gt;<span class="hljs-operator">not</span> fit <span class="hljs-command"><span class="hljs-keyword">on</span> <span class="hljs-title">a</span> <span class="hljs-title">row</span>.</span>

  Bob<span class="hljs-comment">--&gt;Alice: Checking with John...</span>
  Alice-&gt;John: Yes... John, how are you?
</code></pre><div class="mermaid">
sequenceDiagram
  Alice ->> Bob: Hello Bob, how are you?
  Bob-->>John: How about you John?
  Bob--x Alice: I am good thanks!
  Bob-x John: I am good thanks!
  Note right of John: Bob thinks a long<br/>long time, so long<br/>that the text does<br/>not fit on a row.

  Bob-->Alice: Checking with John...
  Alice->John: Yes... John, how are you?
</div>
<h2 id="side-note">Side note</h2>
<p>The CSS I use to style the diagram can be seen <a href="https://raw.githubusercontent.com/npatmaja/nauvalatmaja.com/master/src/render/styles/mermaid.less">here</a>. Happy diagramming!</p>

    </div>
    
        <div class="twitter-share">
  <a href='https://twitter.com/intent/tweet?text=Rendering+Mermaid+in+Docpad&url=http://nauvalatmaja.com/2015/01/13/rendering-mermaid-in-docpad/&via=novalpas&hashtags=Mermaid%2CDocPad%2CMarked%2Cdocpad-plugin-marked' class='twitter-share-button' data-via='novalpas' data-count= 'none'><img src='/ico/twitter_white_small.png', width='16px', height='16px'/>tweet</a>
</div>

    
    
        <div class="post-tags">
            Posted In: 
  <a href='/tags/mermaid/'>Mermaid</a>

  <a href='/tags/docpad/'>DocPad</a>

  <a href='/tags/marked/'>Marked</a>

  <a href='/tags/docpad-plugin-marked/'>docpad-plugin-marked</a>
 
        </div>
    
</article> 
            <!-- get next and prev link -->
            
            <div class="page-nav">
              
                
              
                
                    
                        <a href="/2015/01/30/upload-files-with-backbone-nodejs-express-4/" class="page-nav-newer">
                          Upload Files with Backbone.js, Node.js and express 4.x <span class="icon icon-arrow-right-2"></span>
                        </a>
                    
                    
                         <a href="/2015/01/08/Android-development-with-Genymotion/" class="page-nav-older">
                          <span class="icon icon-arrow-left-2"></span> Android Development with Genymotion
                        </a>
                    
                
              
                
              
                
              
                
              
                
              
            </div>
            <div id="disqus_thread"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div>
<script type="text/javascript">
    var disqus_shortname = 'nauvalatmaja';
    var disqus_url = 'http://nauvalatmaja.com/2015/01/13/rendering-mermaid-in-docpad/';
    var disqus_identifier = disqus_url;
    var disqus_title = 'Rendering Mermaid in Docpad';

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>

            <div id="me">
    <p>
        <img src="/images/avatar.png", alt="nauval atmaja">
        Hello, I'm Nauval Atmaja, a software developer who has interest in software architecture and new cool stuff. 
        Unfortunately, I'm no gamer myself but I will still have fun playing Winning Eleven or Pro Evolution Soccer.
        Have a look around and don't hesitate to <a href="mailto:nauval.atmaja@gmail.com">contact me</a> with any comments,
        suggestions or even to just say Hi!
    </p>
    <p>
        <a href="https://twitter.com/novalpas/">@novalpas</a> &#8226;
        <a href="https://github.com/npatmaja">GitHub</a> &#8226;
        <a href="https://id.linkedin.com/in/nauvalatmaja/">linkedin</a> &#8226;
        <a href="mailto:nauval.atmaja@gmail.com">Email Me</a>
    </p>
</div>

        </div>
    </div>
</div>
<div class="container">
    <div class="navbar navbar-footer">
        <p class="navbar-center navbar-text">© Nauval Atmaja 2014 - 2015</p>
    </div>
</div>


<script src="/vendor/jquery/dist/jquery.js"></script>
<script src="/vendor/mermaid.full.min.js"></script>
<script src="/vendor/components-bootstrap/js/bootstrap.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.5/jquery.fancybox.pack.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/coffee-script/1.6.3/coffee-script.min.js"></script>



<script type="text/javascript">
	var $buoop = {
		url: 'http://whatbrowser.org/',
        reminder: 0,
		newwindow: false,
		'text': 'You are using an outdated browser (%s). <a%s>More information &#187;</a>',
		'text_af': 'Jy gebruik \'n verouderde webblaaier (%s). <a%s>Meer inligting &#187;</a>',
		'text_cs': 'Používáte zastaralý prohlížeč (%s). <a%s>Více informací &#187;</a>',
		'text_da': 'Du bruger en ældre browser (%s). <a%s>Mere information &#187;</a>',
		'text_de': 'Sie benutzen einen veralteten Browser (%s). <a%s>Mehr Informationen &#187;</a>',
		'text_el': 'Χρησιμοποιείτε ένα ξεπερασμένο πρόγραμμα περιήγησης. <a%s>Περισσότερες πληροφορίες &#187;</a>',
		'text_es': 'Su navegador está obsoleto (%s). <a%s>M&aacute;s informaci&oacute;n &#187;</a>',
		'text_fi': 'Käytät vanhentunutta selainta (%s). <a%s>Lisää tietoa &#187;</a>',
		'text_fr': 'Votre navigateur n\'est pas à jour (%s). <a%s>Plus d\'information &#187;</a>',
		'text_hu': 'A böngészője elavult (%s). <a%s>További információ &#187;</a>',
		'text_id': 'Anda menggunakan web browser versi lama (%s). <a%s>Informasi selengkapnya &#187;</a>',
		'text_is': 'Þú ert að nota úreltan vafra (%s). <a%s>Nánari upplýsingar &#187;</a>',
		'text_it': 'Stai usando un browser datato (%s). <a%s>Ulteriori informazioni &#187;</a>',
		'text_nl': 'U gebruikt op dit moment een verouderde webbrowser (%s). <a%s>Meer informatie &#187;</a>',
		'text_pl': 'Używasz przestarzałej przeglądarki (%s). <a%s>Więcej informacji &#187;</a>',
		'text_pt': 'Você está usando um navegador antigo (%s). <a%s>Mais informações &#187;</a>',
		'text_ro': 'Browserul dumneavoastră este depăşit (%s). <a%s>Mai multe informații &#187;</a>',
		'text_ru': 'Вы используете устаревший браузер (%s). <a%s>Подробнее &#187;</a>',
		'text_sk': 'Používate zastaralý prehliadač (%s). <a%s>Viac informácií &#187;</a>',
		'text_sr': 'Vi koristite zastarelu verziju browsera (%s). <a%s>Vi&#353;e informacija &#187;</a>',
		'text_sv': 'Du använder en gammal webbläsare (%s). <a%s>Mer information &#187;</a>',
		'text_tr': 'Çok eski bir tarayıcı kullanıyorsunuz (%s). <a%s>Daha fazla bilgi &#187;</a>',
		'text_vi': 'Trình duyệt bạn dùng đã lỗi thời rồi (%s). <a%s>Thêm thông tin &#187;</a>'
	};
	$buoop.ol = window.onload;
	window.onload=function(){
		try {if ($buoop.ol) $buoop.ol();}catch (e) {}
		var e = document.createElement("script");
		e.setAttribute("type", "text/javascript");
		e.setAttribute("src", "//browser-update.org/update.js");
		document.body.appendChild(e);
	}
</script>

</body>
</html>